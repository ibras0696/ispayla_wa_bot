# Bot Memory Notes

## О проекте
- WhatsApp бот на `whatsapp-chatbot-python` + Postgres.
- Основные модули: `app/bot/handlers` (basic/menu/sell/buy), `app/bot/services` (state/forms/guard), `app/database` (CRUD), UI кнопки в `app/bot/ui/buttons.py`.
- Docker-compose поднимает `postgres` и `bot`, база хранится в volume `pg_data`, фото в `media/` (маунтится внутрь контейнера).

## Текущие сценарии
1. **Главное меню (`0`, `00`, `000`)**
   - Кнопки: Профиль, Продажа, Покупка + текстовые эквиваленты.
2. **Профиль**
   - Команда `профиль`/`profile` или кнопка.
   - Показывает ID, имя, баланс, дату регистрации (данные из `users`).
3. **Продажа**
   - Подменю: «Разместить объявление», «Мои объявления».
   - Мастер создания объявления (заголовок → описание → цена → марка → год → пробег → VIN → фото). Фото присылаются как медиа, сохраняются в `media/uploads`, максимум 3.
   - Объявления сразу активны; сохраняются в `ads`, марки — в `car_brands`, фото — в `ad_images`.
   - «Мои объявления» показывает статистику и последние записи. После списка можно написать `объявление 1` или `объявление ID42`, чтобы получить карточку и фото.
4. **Покупка**
   - Пока заглушка.

## Что помнить при продолжении
- Состояния формы (`SellFormManager`) хранятся в памяти процесса. При рестарте всё обнуляется — важно предупредить тестировщиков.
- Если понадобятся встроенные состояния библиотеки (`notification.state_manager`), можно мигрировать мастера туда.
- В будущем для масштабирования state стоит вынести в Redis/БД.

## Как мне напомнить о контексте
1. Перед началом нового сеанса попроси: `cat docs/memory/notes.md`.
2. После того как я прочитаю файл, кратко сформулируй задачу.
3. Если появятся новые ключевые решения/архитектурные изменения — дополняй этот файл (в том числе инструкции).

## TODO идеи
- Реализовать сценарий «Покупка» (фильтрация объявлений).
- Добавить статусы/модерацию при сохранении объявлений.
- Хранить состояние мастера во внешнем хранилище, чтобы переживать рестарты.
- Сделать кнопки для перелистывания объявлений и отдельный просмотр фото.

## Как восстановить контекст при новом запуске
1. Прочитать `docs/memory/notes.md` (эту памятку).
2. Просмотреть `README.md`, чтобы увидеть поддерживаемые команды/сценарии.
3. `ls app/bot/handlers app/bot/services` — освежить структуру обработчиков и сервисов, при необходимости заглянуть в `handlers/menu.py`, `handlers/sell.py`, `services/forms.py`.
4. Проверить окружение: `docker compose ps` или `make restart`, чтобы убедиться, что Postgres и bot запущены.
5. Поддерживать папку `media/uploads` и volume в docker-compose, чтобы фото объявлений не терялись.
6. В случае новых задач сразу дополнять этот файл, чтобы не потерять важные решения.
